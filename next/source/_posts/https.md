---
title: https 工作原理
translate_title: https
date: 2019-08-21 11:14:19
categories:
- 网络
tags:
- https
- 非对称加密
---

HTTPS的协议是由HTTP协议和SSL/TLS协议组成。HTTP协议就不用讲了，而SSL/TLS就是负责加密解密(可参考{% post_link cryptography-basis 密码学基础%})等安全处理的模块，所以HTTPS的核心在SSL/TLS上面。
整个通信如下：
* 浏览器发起往服务器的443端口发起请求，请求携带了浏览器支持的加密算法和哈希算法。
* 服务器收到请求，选择浏览器支持的加密算法和哈希算法。
* 服务器下发数字证书返回给浏览器，这里的数字证书可以是向某个可靠机构申请的，也可以是自制的。
* 浏览器进入数字证书认证环节，这一部分是浏览器内置的TLS完成的：
<!-- more -->
	+ 首先浏览器会从内置的证书列表中索引，找到服务器下发证书对应的机构，如果没有找到，此时就会提示用户该证书是不是由权威机构颁发，是不可信任的。如果查到了对应的机构，则取出该机构颁发的公钥。
	+ 用机构的证书公钥解密得到证书的内容和证书签名，内容包括网站的网址、网站的公钥、证书的有效期等。浏览器会先验证证书签名的合法性。签名通过后，浏览器验证证书记录的网址是否和当前网址是一致的，不一致会提示用户。如果网址一致会检查证书有效期，证书过期了也会提示用户。这些都通过认证时，浏览器就可以安全使用证书中的网站公钥了。
	+ 浏览器生成一个随机数R，并使用网站公钥对R进行加密。
* 浏览器将加密的R传送给服务器。
* 服务器用自己的私钥解密得到R。
* 服务器以R为密钥使用了对称加密算法加密网页内容并传输给浏览器。
* 浏览器以R为密钥使用之前约定好的解密算法获取网页内容。
<img src="https://public-1251890033.cos.ap-guangzhou.myqcloud.com/blog/network/https.jpg">
